expname: test

# metadata specialised for each experiment
core:
  version: 0.0.1
  tags:
    - ${now:%Y-%m-%d}

hydra:
  run:
    dir: ${oc.env:HYDRA_JOBS}/singlerun/${now:%Y-%m-%d}/${expname}/

  sweep:
    dir: ${oc.env:HYDRA_JOBS}/multirun/${now:%Y-%m-%d}/${expname}/
    subdir: ${hydra.job.num}_${hydra.job.id}

  job:
    env_set:
      WANDB_START_METHOD: thread
      WANDB_DIR: ${oc.env:WABDB_DIR}

  launcher:
    submitit_folder: ${hydra.sweep.dir}/logs/%j
    timeout_min: 4320
    cpus_per_task: 10
    gpus_per_node: ${train.pl_trainer.gpus}
    tasks_per_node: ${train.pl_trainer.gpus}
    mem_gb: 100
    nodes: 1
    name: ${expname}
    _target_: hydra_plugins.hydra_submitit_launcher.submitit_launcher.SlurmLauncher
    partition: ocp
    # qos: null
    # comment: null
    constraint: "volta32gb"
    # exclude: null
    # gres: null
    # cpus_per_gpu: null
    # gpus_per_task: null
    # mem_per_gpu: null
    # mem_per_cpu: null
    # account: null
    # signal_delay_s: 120
    # max_num_timeout: 0
    # additional_parameters: {}
    # array_parallelism: 256
    # setup: null
    # srun_args: null

defaults:
  - data: default
  - logging: default
  - model: vae
  - optim: default
  - train: default
#    Decomment this parameter to get parallel job running
  # - override hydra/launcher: joblib
  - override hydra/launcher: submitit_slurm
